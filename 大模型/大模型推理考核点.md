### Q1ï¼šRMSNorm ç›¸æ¯”è¾ƒ LayerNormä¸ºä»€ä¹ˆå¯ä»¥å‡å°‘å‚æ•°é‡ï¼ŸåŸç†æ˜¯ä»€ä¹ˆï¼Ÿ
ç›¸æ¯”è¾ƒLayerNorm, RMSNorm é€šè¿‡çœç•¥äº†å¯å­¦ä¹ å‚æ•°ï¼šå¹³ç§»å‚æ•° $\beta$, å°†å‚æ•°é‡ä»2dé™ä½åˆ°dï¼ˆdä¸ºè¾“å…¥xå‘é‡çš„ç»´åº¦ï¼‰, ä»è€Œå‡å°‘äº†æ¨¡å‹çš„å¤æ‚åº¦å’Œè®¡ç®—å¼€é”€ã€‚åŒæ—¶ï¼Œå¤§æ¨¡å‹å®éªŒè¡¨æ˜ï¼Œæ€§èƒ½ç›¸æ¯”å‰è€…ç›¸å½“ç”šè‡³æ›´å¥½ã€‚  

**LayerNormå…·ä½“å…¬å¼å¦‚ä¸‹**ï¼š  
$$Layernorm(x) = \gamma * \frac {x - \mu}{\sigma} + \beta$$ 

*P.S. å…¶ä¸­dä¸ªå‚æ•°ç”¨äºç¼©æ”¾ï¼Œdä¸ªå‚æ•°ç”¨äºå¹³ç§»*  

**RMSNormå…·ä½“å…¬å¼å¦‚ä¸‹**ï¼š  
$$RMSNorm(x) = \gamma * \frac {x}{\sqrt{\frac{1}{d}\sum_{i=1}^{d}x_{i}^{2}}}$$

*P.S. å…¶ä¸­dä¸ªå‚æ•°ç”¨äºç¼©æ”¾*  


### Q2ï¼šè¯·ä»‹ç»ä¸‹ä»€ä¹ˆæ˜¯å¤§æ¨¡å‹çš„å¤–æ¨æ€§ï¼Ÿ
å¤§æ¨¡å‹çš„å¤–æ¨å¯ä»¥ç†è§£ä¸ºï¼šç›¸æ¯”è¾ƒè®­ç»ƒè¿‡ç¨‹ä½¿ç”¨çš„è®­ç»ƒæ–‡æœ¬tokené•¿åº¦ï¼Œå¤§æ¨¡å‹åœ¨æ¨ç†æ—¶ï¼Œå…¶èƒ½é€‚åº”æ›´é•¿åºåˆ—æ–‡æœ¬è¾“å…¥ï¼ˆå¦‚å¤šè½®å¯¹è¯åœºæ™¯ï¼‰ï¼Œèƒ½å¤Ÿå¯¹äºè¶…è¿‡ä¸Šä¸‹æ–‡çª—å£æ›´è¿œè·ç¦»çš„è¯å…ƒè¿›è¡Œæœ‰æ•ˆå»ºæ¨¡ï¼Œæ¨ç†æ€§èƒ½ä¾æ—§ã€‚æ¯”å¦‚ï¼Œè®­ç»ƒè¿‡ç¨‹ä½¿ç”¨çš„æ–‡æœ¬tokené•¿åº¦æ˜¯512, åœ¨æ¨ç†è¿‡ç¨‹è¾“å…¥çš„æ–‡æœ¬tokené•¿åº¦ä¸º1024ï¼Œå…¶æ¨ç†æ•ˆæœå¹¶æœªå‡ºç°æ˜æ˜¾ä¸‹é™ã€‚


### Q3ï¼šè¯·ä»‹ç»ä¸‹ä»€ä¹ˆæ˜¯å¤§æ¨¡å‹ä½ç½®ç¼–ç çš„å‡ ç§å½¢å¼ï¼Ÿ
+ **ç»å¯¹ä½ç½®ç¼–ç **  
  + Sinusoidal Eencodingï¼ˆæ­£æ—‹å’Œä½™æ—‹ç¼–ç ï¼‰
    + å…¬å¼å¦‚ä¸‹ï¼š  
    $PE(pos, 2i) = sin(\frac{pos}{{10000}^{\frac{2i}{d}}})$  
    $PE(pos, 2i+1) = cos(\frac{pos}{{10000}^{\frac{2i}{d}}})$  
    *pos: sequence ç´¢å¼• (0,1,2,...,seq_len-1);   
    i: è¯åµŒå…¥ç‰¹å¾ç»´åº¦ç´¢å¼• (0,1,2,...d//2);   
    d: è¯åµŒå…¥ç‰¹å¾çš„ç»´åº¦;*
    + ä¼˜ç‚¹ï¼šåœ¨è¯åµŒå…¥å‘é‡ä¸­åŠ å…¥ç»å¯¹ä½ç½®ç¼–ç ä¿¡æ¯ï¼Œtransformerä¸­å¼•å…¥äº†ç»å¯¹ä½ç½®ä¿¡æ¯ï¼Œå…³æ³¨äº†åºåˆ—çš„è¯ä¿¡æ¯ã€‚
    + ç¼ºç‚¹ï¼šæœªè€ƒè™‘ç›¸å¯¹ä½ç½®ä¿¡æ¯ï¼Œä¸å…·å¤‡å¤–æ¨æ€§ã€‚
  + å¯å­¦ä¹ å‚æ•°
    + æ›¿æ¢æ­£æ—‹å’Œä½™æ—‹ç¼–ç ï¼Œé€šè¿‡æ¨¡å‹å­¦ä¹ å¾—åˆ°ï¼Œä¼˜ç¼ºç‚¹åŒä¸Šã€‚
+ **ç›¸å¯¹ä½ç½®ç¼–ç **
    + ç›¸å¯¹ä½ç½®ç¼–ç é€šå¸¸åº”ç”¨äºæ³¨æ„åŠ›çŸ©é˜µçš„è®¡ç®—ä¸­ï¼Œè€Œä¸æ˜¯ç›´æ¥ä¸è¯å…ƒåµŒå…¥å‘é‡è¿›è¡Œç›¸åŠ ã€‚
    + ä»£è¡¨ç®—æ³•ï¼šTransformer-XLï¼ŒT5ï¼ˆå¼•å…¥å¯å­¦ä¹ çš„ç›¸å¯¹ä½ç½®æ ‡é‡è¡¨å¾Qï¼ŒKçš„ç›¸å¯¹è·ç¦»ï¼‰ã€‚
    + ä¼˜ç‚¹ï¼šå·²ç»å…·å¤‡ä¸€å®šçš„å¤–æ¨æ€§ã€‚
+ **RoPEæ—‹è½¬ä½ç½®ç¼–ç **
    + é€šè¿‡åŸºäºç»å¯¹ä½ç½®çš„æ—‹è½¬çŸ©é˜µæ¥è¡¨ç¤ºæ³¨æ„åŠ›æœºåˆ¶ä¸­çš„Qï¼ŒKç›¸å¯¹ä½ç½®ä¿¡æ¯ã€‚å¹¶è®ºè¯äº†ï¼š*ä½ç½®ç´¢å¼•içš„æ—‹è½¬çŸ©é˜µå’Œä½ç½®ç´¢å¼•jçš„æ—‹è½¬çŸ©é˜µçš„ä¹˜ç§¯=ç›¸å¯¹è·ç¦»çš„i-jçš„æ—‹è½¬çŸ©é˜µ*ã€‚ï¼ˆäºŒç»´å‘é‡->å¤å¹³é¢è¡¨ç¤º->æåæ ‡è¡¨ç¤º->æ—‹è½¬çŸ©é˜µè¡¨ç¤º->æ¨å¹¿åˆ°ä¸€èˆ¬ç»´åº¦çš„å‘é‡ï¼‰
    + ä¼˜ç‚¹ï¼šæ³¨æ„åŠ›æœºåˆ¶ä¸­å¼•å…¥ï¼Œæ— éœ€é¢å¤–çš„ä½ç½®ç¼–ç å‘é‡ï¼Œç®€å•é«˜æ•ˆï¼Œæ— éœ€æ˜¾ç¤ºä½ç½®ç¼–ç ã€‚åŠ å…¥äº†ç›¸å¯¹ä½ç½®ä¿¡æ¯ï¼Œè‰¯å¥½çš„å¤–æ¨æ€§èƒ½ä»¥åŠé•¿æœŸè¡°å‡çš„ç‰¹æ€§
    + ä»£è¡¨ç®—æ³•ï¼šPaLMï¼ŒLLaMAï¼ŒDeepSeek
+ **Abiliä½ç½®ç¼–ç **
    + ALiBi é€šè¿‡åœ¨é”®å’ŒæŸ¥è¯¢ä¹‹é—´çš„è·ç¦»ä¸Šæ–½åŠ ç›¸å¯¹è·ç¦»ç›¸å…³çš„æƒ©ç½šæ¥è°ƒæ•´æ³¨æ„åŠ›åˆ†æ•°ã€‚å…¶ä¸­ï¼Œåœ¨å¤šå¤´æ³¨æ„åŠ›ä¸‹(8å¤´)ï¼Œæ¯ä¸ªå¤´ä¼šåˆ†é…ä¸åŒçš„å€¼ã€‚$\frac{1}{2}$, $\frac{1}{2^2}$, $\frac{1}{2^3}$, $\frac{1}{2^4}$...$\frac{1}{2^8}$ã€‚  
    *P.S. i âˆ’ j æ˜¯æŸ¥è¯¢å’Œé”®ä¹‹é—´çš„ä½ç½®åç§»é‡ï¼Œğ‘š æ˜¯æ¯ä¸ªæ³¨æ„åŠ›å¤´ç‹¬æœ‰çš„æƒ©ç½šç³»æ•°*ã€‚
    + ä¼˜ç‚¹ï¼šæ³¨æ„åŠ›æœºåˆ¶ä¸­å¼•å…¥ï¼Œæ— éœ€é¢å¤–çš„ä½ç½®ç¼–ç å‘é‡ï¼Œç®€å•é«˜æ•ˆï¼Œæ— éœ€æ˜¾ç¤ºä½ç½®ç¼–ç ï¼ŒALiBi å±•ç°å‡ºäº†ä¼˜ç§€çš„å¤–æ¨æ€§èƒ½ï¼Œèƒ½å¤Ÿå¯¹äºè¶…è¿‡ä¸Šä¸‹æ–‡çª—å£æ›´è¿œè·ç¦»çš„è¯å…ƒè¿›è¡Œæœ‰æ•ˆå»ºæ¨¡ã€‚
    + ç¼ºç‚¹ï¼šæ— æ³•æ•æ‰å¤æ‚çš„ç›¸å¯¹ä½ç½®å…³ç³»

RoPEå…¬å¼å¦‚ä¸‹ï¼š  
æ–¹æ³•ä¸€ï¼š ç›´æ¥è½¬æ¢ç¨€ç–æ—‹è½¬çŸ©é˜µä¸ºé€å…ƒç´ ä¹˜æ³•  
$$\begin{bmatrix} q_0 \\ q_1 \\ q_2 \\ q_3 \\ . \\ . \\ . \\ q_{d-2} \\ q_{d-1} \end{bmatrix} âŠ— \begin{bmatrix} cosm\theta_0 \\ cosm\theta_0 \\ cosm\theta_1\\ cosm\theta_1 \\ . \\ . \\ . \\ cosm\theta_{\frac{d}{2}-1} \\ cosm\theta_{\frac{d}{2}-1} \end{bmatrix}  + \begin{bmatrix} -q_1 \\ q_0 \\ -q_3 \\ q_2 \\ . \\ . \\ . \\ -q_{d-1} \\ q_{d-2} \end{bmatrix} âŠ— \begin{bmatrix} sinm\theta_0 \\ sinm\theta_0 \\ sinm\theta_1\\ sinm\theta_1 \\ . \\ . \\ . \\ sinm\theta_{\frac{d}{2}-1} \\ sinm\theta_{\frac{d}{2}-1} \end{bmatrix}$$ 

æ–¹æ³•äºŒï¼š å¤å˜å‡½æ•°è¿ç®—ï¼ˆå€ŸåŠ©å‡½æ•°: torch.view_as_complex() å’Œ torch.polar()ï¼‰  
$$\begin{bmatrix} q_0 + iq_1\\ q_2 + iq_3 \\ . \\ . \\ . \\ q_{d-2} + iq_{d-1}  \end{bmatrix} âŠ—  \begin{bmatrix} cosm\theta_0 + isinm\theta_0\\ cosm\theta_1 + isinm\theta_1 \\ . \\ . \\ . \\ cosm\theta_{\frac{d}{2}-1} + isinm\theta_{\frac{d}{2}-1}  \end{bmatrix} = \begin{bmatrix} q_0cosm\theta_0 - q1sinm\theta_0 + i(q_1cosm\theta_0 +q_0sinm\theta_0) \\ q_2cosm\theta_1 - q_3sinm\theta_1 + i(q_3cosm\theta_1 + q_2sinm\theta_1) \\ . \\ . \\ . \\ q_{d-2}cosm\theta_{\frac{d}{2}-1} - q_{d-1}sinm\theta_{\frac{d}{2}-1} + i(q_{d-1}cosm\theta_{\frac{d}{2}-1} + q_{d-2}sinm\theta_{\frac{d}{2}-1})  \end{bmatrix} $$ 



$$
\begin{bmatrix} 
q_0 \\ q_1 \\ q_2 \\ q_3 \\ \vdots \\ q_{d-2} \\ q_{d-1} 
\end{bmatrix} 
\otimes 
\begin{bmatrix} 
\cos m\theta_0 \\ \cos m\theta_0 \\ \cos m\theta_1 \\ \cos m\theta_1 \\ \vdots \\ \cos m\theta_{\frac{d}{2}-1} \\ \cos m\theta_{\frac{d}{2}-1} 
\end{bmatrix}  
+ 
\begin{bmatrix} 
-q_1 \\ q_0 \\ -q_3 \\ q_2 \\ \vdots \\ -q_{d-1} \\ q_{d-2} 
\end{bmatrix} 
\otimes 
\begin{bmatrix} 
\sin m\theta_0 \\ \sin m\theta_0 \\ \sin m\theta_1 \\ \sin m\theta_1 \\ \vdots \\ \sin m\theta_{\frac{d}{2}-1} \\ \sin m\theta_{\frac{d}{2}-1} 
\end{bmatrix}
$$